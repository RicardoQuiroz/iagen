<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Actividad Drag & Drop</title>
<style>
  body {
    font-family: 'Inter', sans-serif;
    background-color: #f3f4f6;
    margin: 0; padding: 0;
    display: flex; justify-content: center; align-items: center;
    min-height: 100vh;
  }
  .card {
    background: white;
    border-radius: 1rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    padding: 2rem;
    max-width: 600px;
    width: 90%;
  }
  h2 { text-align: center; color: #374151; }
  input, button {
    width: 100%;
    padding: 0.8rem;
    margin-top: 1rem;
    border-radius: 0.5rem;
    border: 1px solid #d1d5db;
    font-size: 1rem;
  }
  button {
    background-color: #3b82f6;
    color: white;
    border: none;
    cursor: pointer;
  }
  button:hover { background-color: #2563eb; }
  .dropzone {
    display: inline-block;
    min-width: 80px;
    padding: 0.2rem 0.5rem;
    margin: 0 0.3rem;
    border-bottom: 2px dashed #9ca3af;
  }
  .word {
    background-color: #e0f2fe;
    border: 1px solid #7dd3fc;
    border-radius: 0.5rem;
    padding: 0.4rem 0.8rem;
    margin: 0.3rem;
    display: inline-block;
    cursor: grab;
  }
  .word.dragging { opacity: 0.5; }
  .result {
    margin-top: 1.5rem;
    font-weight: bold;
    text-align: center;
  }
  .hidden { display: none; }
  #scoreboard { margin-top: 1.5rem; }
  table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
  th, td { border: 1px solid #d1d5db; padding: 0.5rem; text-align: center; }
  th { background-color: #f3f4f6; }
</style>
</head>
<body>

<div id="login" class="card">
  <h2>Ingresa tu Nickname Numérico</h2>
  <input type="number" id="nickname" placeholder="Ej: 12345" />
  <button onclick="startGame()">Comenzar</button>
</div>

<div id="game" class="card hidden">
  <h2>Completa las frases</h2>
  <p>Es labor del profesor conseguir que el aprendizaje sea más 
    <span class="dropzone" data-answer="personal"></span> 
    y se adapte al 
    <span class="dropzone" data-answer="ritmo"></span> 
    y al 
    <span class="dropzone" data-answer="estilo"></span> 
    de cada alumno.
  </p>
  <p>Una parte del contenido disponible en internet está además publicado con licencias 
    <span class="dropzone" data-answer="abiertas"></span>, 
    tales como Creative Commons o similar, por lo que es posible, no sólo 
    <span class="dropzone" data-answer="acceder"></span> 
    a los contenidos, sino también 
    <span class="dropzone" data-answer="reutilizarlos"></span> 
    y 
    <span class="dropzone" data-answer="adaptarlos"></span> 
    dentro del contexto de un curso.
  </p>

  <div id="wordBank">
    <div class="word" draggable="true" data-word="abiertas">abiertas</div>
    <div class="word" draggable="true" data-word="adaptarlos">adaptarlos</div>
    <div class="word" draggable="true" data-word="personal">personal</div>
    <div class="word" draggable="true" data-word="acceder">acceder</div>
    <div class="word" draggable="true" data-word="ritmo">ritmo</div>
    <div class="word" draggable="true" data-word="reutilizarlos">reutilizarlos</div>
    <div class="word" draggable="true" data-word="estilo">estilo</div>
  </div>

  <button onclick="checkAnswers()">Revisar</button>
  <div id="result" class="result"></div>
  <button onclick="showScoreboard()">Ver tabla de puntajes</button>
</div>

<div id="scoreboard" class="card hidden">
  <h2>Tabla de Puntajes</h2>
  <table>
    <thead><tr><th>Nickname</th><th>Puntaje</th></tr></thead>
    <tbody id="scoreTable"></tbody>
  </table>
  <button onclick="downloadJSON()">Descargar JSON</button>
  <button onclick="backToGame()">Volver</button>
</div>

<script>
let currentUser = null;

// --- Pantalla inicial ---
function startGame() {
  const nick = document.getElementById('nickname').value.trim();
  if (!nick || isNaN(nick)) {
    alert("Por favor ingresa un número válido.");
    return;
  }
  currentUser = nick;
  document.getElementById('login').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
}

// --- Drag & Drop y fallback click ---
const words = document.querySelectorAll('.word');
const dropzones = document.querySelectorAll('.dropzone');
let selectedWord = null;

words.forEach(word => {
  word.addEventListener('dragstart', e => {
    e.dataTransfer.setData('text', word.dataset.word);
    word.classList.add('dragging');
  });
  word.addEventListener('dragend', () => word.classList.remove('dragging'));
  word.addEventListener('click', () => {
    if (selectedWord === word) {
      selectedWord.classList.remove('selected');
      selectedWord = null;
    } else {
      if (selectedWord) selectedWord.classList.remove('selected');
      selectedWord = word;
      selectedWord.classList.add('selected');
    }
  });
});

dropzones.forEach(zone => {
  zone.addEventListener('dragover', e => e.preventDefault());
  zone.addEventListener('drop', e => {
    e.preventDefault();
    const dropped = e.dataTransfer.getData('text');
    zone.textContent = dropped;
    zone.dataset.user = dropped;
  });
  zone.addEventListener('click', () => {
    if (selectedWord) {
      zone.textContent = selectedWord.dataset.word;
      zone.dataset.user = selectedWord.dataset.word;
      selectedWord.classList.remove('selected');
      selectedWord = null;
    }
  });
});

// --- Calificación ---
function checkAnswers() {
  let score = 0;
  dropzones.forEach(zone => {
    if (zone.dataset.user === zone.dataset.answer) {
      zone.style.borderBottom = "2px solid #16a34a";
      score++;
    } else {
      zone.style.borderBottom = "2px solid #dc2626";
    }
  });
  const result = `Tu puntaje: ${score} / ${dropzones.length}`;
  document.getElementById('result').textContent = result;
  saveScore(currentUser, score);
}

// --- Guardar puntajes ---
function saveScore(user, score) {
  const data = JSON.parse(localStorage.getItem('scores') || '[]');
  data.push({ nickname: user, score });
  localStorage.setItem('scores', JSON.stringify(data));
}

// --- Ver tabla de puntajes ---
function showScoreboard() {
  document.getElementById('game').classList.add('hidden');
  document.getElementById('scoreboard').classList.remove('hidden');
  const tbody = document.getElementById('scoreTable');
  tbody.innerHTML = '';
  const data = JSON.parse(localStorage.getItem('scores') || '[]');
  data.forEach(row => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${row.nickname}</td><td>${row.score}</td>`;
    tbody.appendChild(tr);
  });
}

// --- Descargar JSON ---
function downloadJSON() {
  const data = localStorage.getItem('scores');
  const blob = new Blob([data], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'puntajes.json';
  a.click();
  URL.revokeObjectURL(url);
}

function backToGame() {
  document.getElementById('scoreboard').classList.add('hidden');
  document.getElementById('game').classList.remove('hidden');
}

// --- Funciones de prueba en consola ---
window.testGame = () => {
  console.log("Número de zonas de drop:", document.querySelectorAll('.dropzone').length);
  console.log("Número de palabras disponibles:", document.querySelectorAll('.word').length);
};
</script>
</body>
</html>
